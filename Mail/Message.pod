
=head1 NAME

Mail::Message - general message object


=head1 INHERITANCE

 Mail::Message has extra code in
   Mail::Message::Construct::Reply
   Mail::Message::Construct::Read
   Mail::Message::Construct::Text
   Mail::Message::Construct::Bounce
   Mail::Message::Construct::Build
   Mail::Message::Construct::Forward
   Mail::Message::Construct
   Mail::Message::Construct::Rebuild

 Mail::Message
   is a Mail::Reporter

 Mail::Message is extended by
   Mail::Box::Message
   Mail::Message::Dummy
   Mail::Message::Part


=head1 SYNOPSIS

 use L<Mail::Box::Manager|Mail::Box::Manager>;
 my $mgr    = Mail::Box::Manager->new;
 my $folder = $mgr->open(folder => 'InBox');
 my $msg    = $folder->message(2);    # $msg is a Mail::Message now

 my $subject = $msg->subject;         # The message's subject
 my @cc      = $msg->cc;              # List of Mail::Address'es

 my $msg       = Mail::Message->build(...);
 my $reply_msg = Mail::Message->reply(...);
 my $frwd_msg  = Mail::Message->forward(...);

 my Mail::Message::Head $head = $msg->head;
 my Mail::Message::Body $body = $msg->decoded;
 $msg->decoded->print($outfile);


=head1 DESCRIPTION

A L<Mail::Message|Mail::Message> object is a container for MIME-encoded message information,
as defined by RFC2822.  Everything what is not specificly related to storing
the messages in mailboxes (folders) is implemented in this class.  Methods
which are are related to folders is implemented in the L<Mail::Box::Message|Mail::Box::Message>
extension.

The main methods are L<get()|"The header">, to get information from a message header
field, and L<decoded()|"The body"> to get the intended content of a message.
But there are many more which can assist your program.

Complex message handling, like construction of replies and forwards, are
implemented in separate packages which are autoloaded into this class.
This means you can simply use these methods as if they are part of this class.
Those package add functionality to all kinds of message objects.



=head1 METHODS


=head2 Constructors


$obj-E<gt>B<clone>

=over 4

Create a copy of this message.  Returned is a Mail::Message object.
The head and body, the log and trace levels are taken.  Labels are
copied with the message, but the delete and modified flags are not.
 
BE WARNED: the clone of any kind of message (or a message part) will B<always
be a Mail::Message> object.  For example, a Mail::Box::Message's clone is
detached from the folder of its original.  When you use Mail::Box::addMessage()
with the cloned message at hand, then the clone will automatically
be coerced into the right message type to be added.

See also copyTo() and moveTo().

I<Example:> 

 $copy = $msg->clone;

=back

Mail::Message-E<gt>B<coerce>(MESSAGE)

=over 4

Coerce a MESSAGE into a Mail::Message.  In some
occasions, for instance where you add a message to a folder, this
coercion is automatically called to ensure that the correct message
type is stored.

The coerced message is returned on success, otherwise C<undef>.  The
coerced message may be a reblessed version of the original message
or a new object.  In case the message has to be specialized, for
instance from a general Mail::Message into a Mail::Box::Mbox::Message,
no copy is needed.  However, to coerce a Mail::Internet object into
a Mail::Message, a lot of copying and converting will take place.

Valid MESSAGEs which can be coerced into Mail::Message objects
are of type

=over 4

=item * Any type of L<Mail::Box::Message|Mail::Box::Message>

=item * MIME::Entity's, using L<Mail::Message::Convert::MimeEntity|Mail::Message::Convert::MimeEntity>

=item * Mail::Internet's, using L<Mail::Message::Convert::MailInternet|Mail::Message::Convert::MailInternet>

=back

L<Mail::Message::Part|Mail::Message::Part>'s, which are extensions of C<Mail::Message>'s,
can also be coerced directly from a L<Mail::Message::Body|Mail::Message::Body>.

I<Example:> 

 my $folder  = Mail::Box::Mbox->new;
 my $message = Mail::Message->build(...);

 my $coerced = Mail::Box::Mbox::Message->coerce($message);
 $folder->addMessage($coerced);

Simpler replacement for the previous two lines:

 my $coerced = $folder->addMessage($message);

=back

Mail::Message-E<gt>B<new>(OPTIONS)

=over 4

 Option      Defined in       Default                                                       
 body                         undef                                                         
 body_type                    L<Mail::Message::Body::Lines|Mail::Message::Body::Lines>      
 field_type                   undef                                                         
 head                         undef                                                         
 head_type                    L<Mail::Message::Head::Complete|Mail::Message::Head::Complete>
 log         L<Mail::Reporter>  C<'WARNINGS'>                                                 
 messageId                    undef                                                         
 modified                     <false>                                                       
 trace       L<Mail::Reporter>  C<'WARNINGS'>                                                 
 trusted                      <false>                                                       

. body OBJECT

=over 4

Instantiate the message with a body which has been created somewhere
before the message is constructed.  The OBJECT must be a sub-class
of Mail::Message::Body.  See also L<body()|"The body"> and L<storeBody()|"Internals">.

=back

. body_type CLASS

=over 4

Default type of body to be created for L<readBody()|"Internals">.

=back

. field_type CLASS

. head OBJECT

=over 4

Instantiate the message with a head which has been created somewhere
before the message is constructed.  The OBJECT must be a (sub-)class
of L<Mail::Message::Head|Mail::Message::Head>. See also L<head()|"The header">.

=back

. head_type CLASS

=over 4

Default type of head to be created for L<readHead()|"Internals">.

=back

. log LEVEL

. messageId STRING

=over 4

The id on which this message can be recognized.  If none specified and
not defined in the header --but one is needed-- there will be one assigned
to the message to be able to pass unique message-ids between objects.

=back

. modified BOOLEAN

=over 4

Flags this message as being modified from the beginning on.  Usually,
modification is auto-detected, but there may be reasons to be extra
explicit.

=back

. trace LEVEL

. trusted BOOLEAN

=over 4

Is this message from a trusted source?  If not, the content must be
checked before use.  This checking will be performed when the
body data is decoded or used for transmission.

=back

=back

=head2 Constructing a message


$obj-E<gt>B<bounce>([RG-OBJECT|OPTIONS])

=over 4

See L<Mail::Message::Construct::Bounce/"Constructing a message">

=back

Mail::Message-E<gt>B<build>([MESSAGE|BODY], CONTENT)

=over 4

See L<Mail::Message::Construct::Build/"Constructing a message">

=back

Mail::Message-E<gt>B<buildFromBody>(BODY, [HEAD], HEADERS)

=over 4

See L<Mail::Message::Construct::Build/"Constructing a message">

=back

$obj-E<gt>B<forward>(OPTIONS)

=over 4

See L<Mail::Message::Construct::Forward/"Constructing a message">

=back

$obj-E<gt>B<forwardPostlude>

=over 4

See L<Mail::Message::Construct::Forward/"Constructing a message">

=back

$obj-E<gt>B<forwardPrelude>

=over 4

See L<Mail::Message::Construct::Forward/"Constructing a message">

=back

$obj-E<gt>B<forwardSubject>(STRING)

=over 4

See L<Mail::Message::Construct::Forward/"Constructing a message">

=back

Mail::Message-E<gt>B<read>(FILEHANDLE|SCALAR|REF-SCALAR|ARRAY-OF-LINES, OPTIONS)

=over 4

See L<Mail::Message::Construct::Read/"Constructing a message">

=back

$obj-E<gt>B<rebuild>(OPTIONS)

=over 4

See L<Mail::Message::Construct::Rebuild/"Constructing a message">

=back

$obj-E<gt>B<reply>(OPTIONS)

=over 4

See L<Mail::Message::Construct::Reply/"Constructing a message">

=back

$obj-E<gt>B<replyPrelude>([STRING|FIELD|ADDRESS])

=over 4

See L<Mail::Message::Construct::Reply/"Constructing a message">

=back

$obj-E<gt>B<replySubject>(STRING)

Mail::Message-E<gt>B<replySubject>(STRING)

=over 4

See L<Mail::Message::Construct::Reply/"Constructing a message">

=back

=head2 The Message


$obj-E<gt>B<container>

=over 4

If the message is a part of another message, C<container> returns the
reference to the containing body.

I<Example:> 

 my Mail::Message $msg = ...
 return unless $msg->body->isMultipart;
 my $part   = $msg->body->part(2);

 return unless $part->body->isMultipart;
 my $nested = $part->body->part(3);

 $nested->container;  # returns $msg->body
 $nested->toplevel;   # returns $msg
 $msg->container;     # returns undef
 $msg->toplevel;      # returns $msg
 $msg->isPart;        # returns false
 $part->isPart;       # returns true

=back

$obj-E<gt>B<isDummy>

=over 4

Dummy messages are used to fill holes in linked-list and such, where only
a message-id is known, but not the place of the header of body data.

This method is also available for L<Mail::Message::Dummy|Mail::Message::Dummy> objects,
where this will return C<true>.  On any extension of C<Mail::Message>,
this will return C<false>.

=back

$obj-E<gt>B<isPart>

=over 4

Returns true if the message is a part of another message.  This is
the case for L<Mail::Message::Part|Mail::Message::Part> extensions of C<Mail::Message>.

=back

$obj-E<gt>B<messageId>

=over 4

Retrieve the message's id.  Every message has a unique message-id.  This id
is used mainly for recognizing discussion threads.

=back

$obj-E<gt>B<print>([FILEHANDLE])

=over 4

Print the message to the FILE-HANDLE, which defaults to the selected
filehandle, without the encapsulation sometimes required by a folder
type, like L<write()|"The Message"> does.

I<Example:> 

 $message->print(\*STDERR);  # to the error output
 $message->print;            # to the selected file

 my $out = IO::File->new('out', 'w');
 $message->print($out);      # no encapsulation: no folder
 $message->write($out);      # with encapsulation: is folder.

=back

$obj-E<gt>B<send>([MAILER], OPTIONS)

=over 4

Transmit the message to anything outside this Perl program.  MAILER
is a L<Mail::Transport::Send|Mail::Transport::Send> object.  When the MAILER is not specified, one
will be created, and kept as default for the next messages as well.

The OPTIONS are mailer specific, and a mixture of what is usable for
the creation of the mailer object and the sending itself.  Therefore, see
for possible options L<Mail::Transport::Send::new()|"METHODS"> and
L<Mail::Transport::Send::send()|"Sending mail">.

I<Example:> 

 $message->send;

is short (but little less flexibile) for

 my $mailer = L<Mail::Transport::SMTP|Mail::Transport::SMTP>->new(@smtpopts);
 $mailer->send($message, @sendopts);

See examples/send.pl in the distribution of Mail::Box.

=back

$obj-E<gt>B<size>

=over 4

Returns the size of the whole message in bytes.  This does assume that each
line ending is represented by one character (like UNIX, MacOS, and sometimes
Cygwin), and not two characters (like Windows and sometimes Cygwin).

If you write the message to file on a system which uses CR and LF to end a
single line (all Windows versions), the result in file will be nrLines() larger
than this method returns.

=back

$obj-E<gt>B<toplevel>

=over 4

Returns a reference to the main message, which will be the current
message if the message is not part of another message.

=back

$obj-E<gt>B<write>([FILEHANDLE])

=over 4

Write the message to the FILE-HANDLE, which defaults to the selected
FILEHANDLE, with all surrounding information which is needed to put
it correctly in a folder file.

In most cases, the result of C<write> will be the same as with L<print()|"The Message">.
The main exception is for Mbox folder messages, which will get printed
with their leading 'From ' line and a trailing blank.  Each line of
their body which starts with 'From ' will have an 'E<gt>' added in front.

=back

=head2 The header


$obj-E<gt>B<bcc>

=over 4

Returns the addresses which are specified on the C<Bcc> header line (or lines)
A list of Mail::Address objects is returned.
C<Bcc> stands for I<Blind Carbon Copy>: destinations of the message which are
not listed in the messages actually sent.  So, this field will be empty
for received messages, but may be present in messages you construct yourself.

=back

$obj-E<gt>B<cc>

=over 4

Returns the addresses which are specified on the C<Cc> header line (or lines)
A list of Mail::Address objects is returned.  C<Cc> stands for
I<Carbon Copy>; the people addressed on this line receive the message
informational, and are usually not expected to reply on its content.

=back

$obj-E<gt>B<date>

=over 4

Returns the last C<Date> header line as string.

I<Example:> using date() to get the C<Date> header field


 my $date = $message->date;

=back

$obj-E<gt>B<destinations>

=over 4

Returns a list of Mail::Address objects which contains the combined
info of active C<To>, C<Cc>, and C<Bcc> addresses.  Double addresses are
removed if detectable.

=back

$obj-E<gt>B<from>

=over 4

Returns the address of the sender.  It is possible to have more than
one address specified in the C<From> field of the message. Therefore a
list of Mail::Address objects is returned, which usually has
length 1.

If you need one address of a sender, for instance to create a reply to,
then use L<sender()|"The header">.

I<Example:> using from() to get all sender addresses


 my @from = $message->from;

=back

$obj-E<gt>B<get>(FIELD)

=over 4

Returns the value which is stored in the header FIELD with the specified
name.  If the field has multiple appearances in the header, only the last
instance is returned.

The field name is case insensitive.  the I<unfolded body> of the field
is returned, see L<Mail::Message::Field::unfoldedBody()|"Access to the body">.  If you need
more complex handing of fields, then call L<Mail::Message::Head::get()|"Access to the header">
yourself.

I<Example:> the get() short-cut for header fields


 print $msg->get('Content-Type'), "\n";

Is equivalent to:

 print $msg->head->get('Content-Type')->body, "\n";

=back

$obj-E<gt>B<guessTimestamp>

=over 4

Return an estimate on the time this message was sent.  The data is
derived from the header, where it can be derived from the C<date> and
C<received> lines.  For MBox-like folders you may get the date from
the from-line as well.

This method may return C<undef> if the header is not parsed or only
partially known.  If you require a time, then use the timestamp()
method, described below.

I<Example:> using guessTimestamp() to get a transmission date


 print "Receipt ", ($message->timestamp || 'unknown'), "\n";

=back

$obj-E<gt>B<head>([HEAD])

=over 4

Return (optionally after setting) the HEAD of this message.
The head must be an (sub-)class of Mail::Message::Head.
When the head is added, status information is taken from it
and transformed into labels.  More labels can be added by the
LABELS hash.  They are added later.

I<Example:> 

 $msg->head(Mail::Message::Head->new);  # set
 my $head = $msg->head;                 # get

=back

$obj-E<gt>B<nrLines>

=over 4

Returns the number of lines used for the whole message.

=back

$obj-E<gt>B<sender>

=over 4

Returns exactly one address, which is the originator of this message.
The returned Mail::Address object is taken from the C<Sender> header
field, unless that field does not exists, in which case the first
address from the C<From> field is taken.  If none of both provide
an address, C<undef> is returned.

I<Example:> using sender() to get exactly one sender address


 my $sender = $message->sender;
 print "Reply to: ", $sender->format, "\n" if defined $sender;

=back

$obj-E<gt>B<subject>

=over 4

Returns the message's subject, or the empty string.

I<Example:> using subject() to get the message's subject


 print $msg->subject;

=back

$obj-E<gt>B<timestamp>

=over 4

Get a timestamp, doesn't matter how much work it is.  If it is impossible
to get a time from the header-lines, the current time-of-living is taken.

=back

$obj-E<gt>B<to>

=over 4

Returns the addresses which are specified on the C<To> header line (or lines).
A list of Mail::Address objects is returned.  The people addressed
here are the targets of the content, and should read it contents
carefully.

I<Example:> using to() to get all primar destination addresses


 my @to = $message->to;

=back

=head2 The body


$obj-E<gt>B<body>([BODY])

=over 4

Return the body of this message.  BE WARNED that this returns
you an object which may be encoded: use decoded() to get a body
with usable data.

With options, a new BODY is set for this message.  This is B<not>
for normal use unless you understand the consequences: you change
the message content without changing the message-ID.  The right
way to go is via

 $message = Mail::Message->buildFromBody($body);  # or
 $message = Mail::Message->build($body);          # or
 $message = $origmsg->forward(body => $body);

The BODY must be an (sub-)class of Mail::Message::Body.  In this case,
information from the specified body will be copied into the header.  The
body object will be encoded if needed, because messages written to file
or transmitted shall not contain binary data.  The converted body
is returned.

When BODY is C<undef>, the current message body will be dissected from
the message.  All relation will be cut.  The body is returned, and
can be connected to a different message.

I<Example:> 

 my $body      = $msg->body;
 my @encoded   = $msg->body->lines;

 my $new       = Mail::Message::Body->new(mime_type => 'text/html');
 my $converted = $msg->body($new);

=back

$obj-E<gt>B<decoded>(OPTIONS)

=over 4

Decodes the body of this message, and returns it as a body object.  If there
was no encoding, the body object as read from file is passed on, however,
some more work will be needed when a serious encoding is encountered.
The OPTIONS control how the conversion takes place.

 Option       Defined in       Default       
 keep                          <false>       
 result_type                   <type of body>

. keep BOOLEAN

=over 4

Controls whether the decoded result will be kept.  If not, the decoding
may be performed more than once.  However, it will consume extra
resources...

=back

. result_type BODYTYPE

=over 4

Specifies which kind of body should be used for the final result, and
eventual intermediate conversion stages.  It is not sure that this
will be the type of the body returned.  BODYTYPE extends Mail::Message::Body.

=back

I<Example:> 

 $message->decoded->print(\*OUT);
 $message->decoded->print;

 my $dec = $message->body($message->decoded);
 my $dec = $message->decoded(keep => 1);   # same

=back

$obj-E<gt>B<encode>(OPTIONS)

=over 4

Encode the message to a certain format.  Read the details in the
dedicated manual page Mail::Message::Body::Encode.  The OPTIONS which
can be specified here are those of the Mail::Message::Body::encode() method.

=back

$obj-E<gt>B<isMultipart>

=over 4

Check whether this message is a multipart message (has attachments).  To
find this out, we need at least the header of the message; there is no
need to read the body of the message to detect this.

=back

$obj-E<gt>B<isNested>

=over 4

Returns C<true> for C<message/rfc822> messages and message parts.

=back

$obj-E<gt>B<parts>(['ALL'|'ACTIVE'|'DELETED'|'RECURSE'|FILTER])

=over 4

Returns the I<parts> of this message. Usually, the term I<part> is used
with I<multipart> messages: messages which are encapsulated in the body
of a message.  To abstract this concept: this method will return you
all header-body combinations which are stored within this message.
Objects returned are Mail::Message's and Mail::Message::Part's.

The option default to 'ALL', which will return the message itself for
single-parts, the nested content of a message/rfc822 object, respectively
the parts of a multipart without recursion.  In case of 'RECURSE', the
parts of multiparts will be collected recursively.  This option cannot
be combined with the other options, which you may want: it that case
you have to test yourself.

'ACTIVE' and 'DELETED' check for the deleted flag on messages and
message parts.  The FILTER is a code reference, which is called for
each part of the messagei; each part as C<RECURSE> would return.

I<Example:> 

 my @parts = $msg->parts;           # $msg not multipart: returns ($msg)
 my $parts = $msg->parts('ACTIVE'); # returns ($msg)

 $msg->delete;
 my @parts = $msg->parts;           # returns ($msg)
 my $parts = $msg->parts('ACTIVE'); # returns ()

=back

=head2 Flags


$obj-E<gt>B<isModified>

=over 4

Returns whether this message is flagged as being modified.  Modifications
are changes in header lines, when a new body is set to the message
(dangerous), or when labels change.

=back

$obj-E<gt>B<label>(LABEL [,VALUE [LABEL, VALUE] ])

=over 4

Return the value of the LABEL, optionally after setting it to VALUE.  If
the VALUE is C<undef> then the label is removed.  You may specify a list
of LABEL-VALUE pairs at once.  In the latter case, the first VALUE is returned.

Labels are used to store knowledge about handling of the message within
the folder.  Flags about whether a message was read, replied to, or
(in some cases) scheduled for deletion.

Some labels are taken from the header's C<Status> and C<X-Status> lines,
however folder types like MH define a separate label file.

I<Example:> 

 print $message->label('seen');
 if($message->label('seen')) {...};
 $message->label(seen => 1);

=back

$obj-E<gt>B<labels>

=over 4

Returns all known labels.  In SCALAR context, it returns the knowledge
as reference to a hash.  This is a reference to the original data, but
you shall *not* change that data directly: call C<label> for
changes!

In LIST context, you get a list of names which are defined.  Be warned
that they will not all evaluate to true, although most of them will.

=back

$obj-E<gt>B<labelsToStatus>

=over 4

When the labels were changes, there may be an effect for the
C<Status> and/or C<X-Status> header-lines.  Whether this update has
to take place depends on the type of folder.

=back

$obj-E<gt>B<modified>([BOOLEAN])

=over 4

Returns (optionally after setting) whether this message is flagged as
being modified.  See isModified().

=back

$obj-E<gt>B<statusToLabels>

=over 4

Update the labels according the status lines in the header.  Defined values
for the 'Status' field are C<R> (Read, label 'seen') and C<O> (label 'old').
Values for the 'X-Status' field are C<A> (Answered, label 'replied') and
C<F> (label 'flagged').

=back

=head2 The whole message as text


$obj-E<gt>B<file>

=over 4

See L<Mail::Message::Construct::Text/"The whole message as text">

=back

$obj-E<gt>B<lines>

=over 4

See L<Mail::Message::Construct::Text/"The whole message as text">

=back

$obj-E<gt>B<printStructure>([FILEHANDLE][, INDENT])

=over 4

See L<Mail::Message::Construct::Text/"The whole message as text">

=back

$obj-E<gt>B<string>

=over 4

See L<Mail::Message::Construct::Text/"The whole message as text">

=back

=head2 Internals


$obj-E<gt>B<isDelayed>

=over 4

Check whether the message is delayed (not yet read from file).  Returns
true or false, dependent on the body type.

=back

$obj-E<gt>B<readBody>(PARSER, HEAD [, BODYTYPE])

=over 4

Read a body of a message.  The PARSER is the access to the folder's
file, and the HEAD is already read.  Information from the HEAD is used
to create expectations about the message's length, but also to determine
the mime-type and encodings of the body data.

The BODYTYPE determines which kind of body will be made and defaults to
the value specified by new(body_type).
BODYTYPE may be the name of a body class, or a reference
to a routine which returns the body's class when passed the HEAD as only
argument.

=back

$obj-E<gt>B<readFromParser>(PARSER, [BODYTYPE])

=over 4

Read one message from file.  The PARSER is opened on the file.  First
readHeader() is called, and the head is stored in the message.  Then
readBody() is called, to produce a body.  Also the body is added to
the message without decodings being done.

The optional BODYTYPE may be a body class or a reference to a code
which returns a body-class based on the header.

=back

$obj-E<gt>B<readHead>(PARSER [,CLASS])

=over 4

Read a head into an object of the specified CLASS.  The CLASS defaults to
the C<head_type> option specified at creation of the message (see new()).
The PARSER is the access to the folder's file.

=back

$obj-E<gt>B<recursiveRebuildPart>(PART, OPTIONS)

=over 4

See L<Mail::Message::Construct::Rebuild/"Internals">

=back

$obj-E<gt>B<storeBody>(BODY)

=over 4

Where the body() method can be used to set and get a body, with all
the necessary checks, this method is bluntly adding the specified body
to the message.  No conversions, not checking.

=back

$obj-E<gt>B<takeMessageId>([STRING])

=over 4

Take the message-id from the STRING, or create one when the C<undef>
is specified.  If not STRING nor C<undef> is given, the current header
of the message is requested for the value of the C<'Message-ID'> field.

Angles (if present) are removed from the id. 

=back

=head2 Error handling


$obj-E<gt>B<AUTOLOAD>

=over 4

See L<Mail::Message::Construct/"METHODS">

=back

$obj-E<gt>B<defaultTrace>([LEVEL, [LEVEL])

Mail::Message-E<gt>B<defaultTrace>([LEVEL, [LEVEL])

=over 4

See L<Mail::Reporter/"Error handling">

=back

$obj-E<gt>B<errors>

=over 4

See L<Mail::Reporter/"Error handling">

=back

$obj-E<gt>B<log>([LEVEL [,STRINGS]])

Mail::Message-E<gt>B<log>([LEVEL [,STRINGS]])

=over 4

See L<Mail::Reporter/"Error handling">

=back

$obj-E<gt>B<logPriority>(LEVEL)

Mail::Message-E<gt>B<logPriority>(LEVEL)

=over 4

See L<Mail::Reporter/"Error handling">

=back

$obj-E<gt>B<logSettings>

=over 4

See L<Mail::Reporter/"Error handling">

=back

$obj-E<gt>B<notImplemented>

=over 4

See L<Mail::Reporter/"Error handling">

=back

$obj-E<gt>B<report>([LEVEL])

=over 4

See L<Mail::Reporter/"Error handling">

=back

$obj-E<gt>B<reportAll>([LEVEL])

=over 4

See L<Mail::Reporter/"Error handling">

=back

$obj-E<gt>B<trace>([LEVEL])

=over 4

See L<Mail::Reporter/"Error handling">

=back

$obj-E<gt>B<warnings>

=over 4

See L<Mail::Reporter/"Error handling">

=back

=head2 Cleanup


$obj-E<gt>B<DESTROY>

=over 4

When a message is to accessible anymore by any user's reference, Perl
will call DESTROY for final clean-up.  In this case, the head and
body are released, and de-registered for the folder.  You shall not call
this yourself!

=back

$obj-E<gt>B<inGlobalDestruction>

=over 4

See L<Mail::Reporter/"Cleanup">

=back



=head1 DIAGNOSTICS

I<Error:> Cannot include forward source as $include.

Unknown alternative for the L<forward(include)|"Constructing a message">.  Valid choices are
C<NO>, C<INLINE>, and C<ATTACH>.

I<Error:> Cannot include reply source as $include.

Unknown alternative for the C<include> option of L<reply()|"Constructing a message">.  Valid
choices are C<NO>, C<INLINE>, and C<ATTACH>.

I<Error:> No address to create forwarded to.

If a forward message is created, a destination address must be specified.

I<Error:> No default mailer found to send message.

The message L<send()|"The Message"> mechanism had not enough information to automatically
find a mail transfer agent to sent this message.  Specify a mailer
explicitly using the C<via> options.

I<Error:> Package $package does not implement $method.

Fatal error: the specific package (or one of its superclasses) does not
implement this method where it should. This message means that some other
related classes do implement this method however the class at hand does
not.  Probably you should investigate this and probably inform the author
of the package.

I<Error:> no rebuild rule $name defined.



=head1 DETAILS


=head2 Structure of a Message

A MIME-compliant message is build upon two parts: the I<head> and the
I<body>.  The body contains the I<payload>: the data to be transfered.  The
data can be encoded, only accessible with a specific application, and may use
some weird character-set, like Vietnamese; the Mail::Box module tries to
assist you with handling these e-mails without the need to know all the
details.  This additional information (I<meta-information>) about the
body data is stored in the header.

The header is a list of fields, some spanning more than one line (I<folded>)
each telling something about the message. Information stored in here are for
instance the sender of the message, the receivers of the message, when it
was transported, how it was transported, etc etc.  Headers can grow quite
large.

In Mail::Box, each message object manages exactly one header object
(a L<Mail::Message::Head|Mail::Message::Head>) and one body object (a L<Mail::Message::Body|Mail::Message::Body>).
The header contains a list of header fields, which are represented by
L<Mail::Message::Field|Mail::Message::Field> objects.

=head2 Implementation

Mail::Box is as lazy as possible.  Whenever you open a folder, it tries
to avoid processing the messages within that folder.  In stead of parsing
(decoding) the messages when the folder is opened, they are parsed the
moment they are used for the first time.  In Mail::Box, this is called
I<delayed loading>.  You can read more about that in the PDF formatted
papers which are available at the main website of Mail::Box.





=head1 REFERENCES

See the Mail::Box website at L<http://perl.overmeer.net/mailbox/> for more details.

=head1 COPYRIGHTS

Module version 2.041.
Written by Mark Overmeer (mark@overmeer.net).  See the ChangeLog for
other contributors.

Copyright (c) 2001-2003 by the author(s). All rights reserved.
This program is free software; you can redistribute it and/or modify it
under the same terms as Perl itself.


